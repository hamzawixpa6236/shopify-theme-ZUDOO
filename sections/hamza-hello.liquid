{% comment %} Shopify Image/Video Slider Section (alias of hamza-image-banner) {% endcomment %}
<section id="custom-slider" class="custom-slider" style="padding: {{ section.settings.section_padding }}px;">
	<div class="slider-container" style="justify-content: {{ section.settings.content_alignment }};">
		<div class="slider-media">
			{% for block in section.blocks %}
			{% case block.type %}

			{% when 'slide' %}
			<div class="slide-item" style="display:none;">
				{% if block.settings.media_type == 'image' %}
				<img src="{{ block.settings.slide_image | image_url: 'master' }}" alt="slide" width="1200" height="800"
					style="width:100%; height:auto; border-radius: {{ block.settings.media_radius }}px;" />
				{% else %}
				<video autoplay muted loop playsinline
					style="width:100%; border-radius: {{ block.settings.media_radius }}px;">
					<source src="{{ block.settings.slide_video }}" type="video/mp4" />
				</video>
				{% endif %}
			</div>

			{% when 'label' %}
			<div class="top-label"
				style="background: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }}; border-radius: {{ block.settings.label_radius }}px;">
				{{ block.settings.label_text }}
			</div>

			{% when 'heading' %}
			<h2
				style="font-size: {{ block.settings.heading_size }}px; font-family: {{ block.settings.heading_font }}; color: {{ block.settings.heading_color }}; margin-bottom: {{ block.settings.heading_gap }}px;">
				{{ block.settings.heading_text }}
			</h2>

			{% when 'paragraph' %}
			<p
				style="font-size: {{ block.settings.p_size }}px; font-family: {{ block.settings.p_font }}; color: {{ block.settings.p_color }}; margin-bottom: {{ block.settings.p_gap }}px;">
				{{ block.settings.p_text }}
			</p>

			{% when 'button' %}
			<a href="{{ block.settings.btn_link }}" class="custom-btn"
				style="padding: {{ block.settings.btn_padding }}px; color: {{ block.settings.btn_text_color }}; background: {{ block.settings.btn_bg }}; border-radius: {{ block.settings.btn_radius }}px; border: 1px solid {{ block.settings.btn_border }};">
				{{ block.settings.btn_text }}
			</a>

			{% endcase %}
			{% endfor %}
		</div>

		<div class="slider-controls">
			<button class="prev-slide">❮</button>
			<div class="dots"></div>
			<button class="next-slide">❯</button>
		</div>
	</div>
</section>

<style>
	.custom-slider {
		width: 100%;
		position: relative;
	}

	.slider-container {
		display: flex;
		align-items: center;
		width: 100%;
	}

	.slider-media {
		position: relative;
		width: 50%;
	}

	.slide-item img,
	.slide-item video {
		width: 100%;
		border-radius: 10px;
	}

	.top-label {
		position: absolute;
		top: 20px;
		left: 20px;
		padding: 8px 15px;
		font-size: 14px;
		font-weight: 600;
	}

	.custom-btn {
		display: inline-block;
		transition: all 0.5s ease;
	}

	.custom-btn:hover {
		background-position: right top;
	}

	@media(max-width:768px) {
		.slider-container {
			flex-direction: column-reverse;
		}

		.slider-media {
			width: 100%;
		}
	}
</style>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		let slides = document.querySelectorAll('#custom-slider .slide-item');
		let dotsContainer = document.querySelector('#custom-slider .dots');
		let prevBtn = document.querySelector('#custom-slider .prev-slide');
		let nextBtn = document.querySelector('#custom-slider .next-slide');
		let current = 0;

		// Ensure we have a sane duration (fallback to 4 seconds if missing)
		let duration = {{ section.settings.slide_speed | default: 4
	}} * 1000;

	// If there are no slides, nothing to do.
	if (!slides || slides.length === 0) return;

	// Create dots only if container exists
	if (dotsContainer) {
		slides.forEach((_, i) => {
			let dot = document.createElement('span');
			dot.classList.add('dot');
			dot.dataset.index = i;
			dotsContainer.appendChild(dot);
		});
	}

	let dots = document.querySelectorAll('#custom-slider .dot');

	function showSlide(i) {
		// normalize index
		if (i < 0) i = slides.length - 1;
		if (i >= slides.length) i = 0;

		slides.forEach(s => s.style.display = "none");
		if (dots && dots.length) dots.forEach(d => d.classList.remove('active'));

		// guard: ensure element exists before accessing
		if (slides[i]) slides[i].style.display = "block";
		if (dots[i]) dots[i].classList.add('active');
		current = i;
	}

	if (prevBtn) {
		prevBtn.onclick = () => {
			current = (current === 0) ? slides.length - 1 : current - 1;
			showSlide(current);
		};
	}

	if (nextBtn) {
		nextBtn.onclick = () => {
			current = (current + 1) % slides.length;
			showSlide(current);
		};
	}

	if (dots && dots.length) {
		dots.forEach(dot => {
			dot.onclick = () => {
				current = parseInt(dot.dataset.index, 10) || 0;
				showSlide(current);
			};
		});
	}

	showSlide(0);

	// Only set interval if more than one slide
	if (slides.length > 1) {
		setInterval(() => {
			current = (current + 1) % slides.length;
			showSlide(current);
		}, duration);
	}
  });
</script>

{% schema %}
{
"name": "Custom Slider (alias)",
"settings": [
{
"type": "range",
"id": "slide_speed",
"min": 2,
"max": 7,
"step": 1,
"default": 4,
"label": "Slider Speed (seconds)"
},
{
"type": "select",
"id": "content_alignment",
"label": "Content Alignment",
"options": [
{ "value": "left", "label": "Left" },
{ "value": "center", "label": "Center" },
{ "value": "right", "label": "Right" }
],
"default": "left"
},
{
"type": "range",
"id": "section_padding",
"min": 0,
"max": 100,
"step": 5,
"default": 20,
"label": "Section Padding"
}
],
"blocks": [
{
"type": "slide",
"name": "Slide (Image/Video)",
"settings": [
{
"type": "select",
"id": "media_type",
"label": "Media Type",
"options": [
{ "value": "image", "label": "Image" },
{ "value": "video", "label": "Video" }
]
},
{
"type": "image_picker",
"id": "slide_image",
"label": "Slide Image"
},
{
"type": "url",
"id": "slide_video",
"label": "Video URL"
},
{
"type": "range",
"id": "media_radius",
"min": 0,
"max": 50,
"step": 1,
"default": 10,
"label": "Media Border Radius"
}
]
},
{
"type": "label",
"name": "Top Label",
"settings": [
{ "type": "text", "id": "label_text", "label": "Label Text" },
{ "type": "color", "id": "bg_color", "label": "Background Color", "default": "#ffffff" },
{ "type": "color", "id": "text_color", "label": "Text Color", "default": "#000000" },
{ "type": "range", "id": "label_radius", "min": 0, "max": 50, "step": 1, "default": 5, "label": "Border Radius" }
]
},
{
"type": "heading",
"name": "Heading",
"settings": [
{ "type": "text", "id": "heading_text", "label": "Heading Text" },
{ "type": "range", "id": "heading_size", "min": 10, "max": 80, "step": 1, "default": 40, "label": "Font Size" },
{ "type": "font_picker", "id": "heading_font", "label": "Font Family", "default": "assistant_n4" },
{ "type": "color", "id": "heading_color", "label": "Text Color", "default": "#000" },
{ "type": "range", "id": "heading_gap", "min": 0, "max": 50, "step": 1, "default": 10, "label": "Bottom Gap" }
]
},
{
"type": "paragraph",
"name": "Paragraph",
"settings": [
{ "type": "textarea", "id": "p_text", "label": "Paragraph Text" },
{ "type": "range", "id": "p_size", "min": 10, "max": 40, "step": 1, "default": 16, "label": "Font Size" },
{
"type": "font_picker",
"id": "p_font",
"label": "Font Family",
"default": "assistant_n4"
},
{ "type": "color", "id": "p_color", "label": "Text Color", "default": "#333" },
{ "type": "range", "id": "p_gap", "min": 0, "max": 50, "step": 1, "default": 10, "label": "Bottom Gap" }
]
},
{
"type": "button",
"name": "Button",
"settings": [
{ "type": "text", "id": "btn_text", "label": "Button Text" },
{ "type": "url", "id": "btn_link", "label": "Button Link" },
{ "type": "range", "id": "btn_padding", "min": 5, "max": 40, "step": 1, "default": 10, "label": "Padding" },
{ "type": "range", "id": "btn_radius", "min": 0, "max": 50, "step": 1, "default": 5, "label": "Border Radius" },
{ "type": "color", "id": "btn_bg", "label": "Background Color", "default": "#000" },
{ "type": "color", "id": "btn_border", "label": "Border Color", "default": "#000" },
{ "type": "color", "id": "btn_text_color", "label": "Text Color", "default": "#fff" },
{ "type": "color", "id": "btn_hover", "label": "Hover Color", "default": "#ffcc00" }
]
}
],
"presets": [
{ "name": "Custom Slider" }
]
}
{% endschema %}

